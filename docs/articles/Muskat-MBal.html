<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Muskat Material Balance • rODE</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">rODE</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Comparison.html">Comparison of ODE solvers</a>
    </li>
    <li>
      <a href="../articles/Comparison_naode.html">Comparison of ODE solvers: Example NAODE</a>
    </li>
    <li>
      <a href="../articles/ErrorEuler.html">Error vs step size with Euler method</a>
    </li>
    <li>
      <a href="../articles/FallingParticle.html">Falling Particle ODE</a>
    </li>
    <li>
      <a href="../articles/Kepler.html">Kepler. Interaction between two planets</a>
    </li>
    <li>
      <a href="../articles/Muskat-MBal.html">Muskat Material Balance</a>
    </li>
    <li>
      <a href="../articles/Pendulum.html">Pendulum with Euler-Richardson ODE solver</a>
    </li>
    <li>
      <a href="../articles/Planet.html">Planet orbiting with Euler ODE solver</a>
    </li>
    <li>
      <a href="../articles/Projectile.html">Projectile with RK4 solver</a>
    </li>
    <li>
      <a href="../articles/Reaction.html">Chemical Reaction</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/f0nzie/rODE">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Muskat Material Balance</h1>
                        <h4 class="author">Alfonso R. Reyes</h4>
            
            <h4 class="date">2017-11-09</h4>
          </div>

    
    
<div class="contents">
<div id="muskats-material-balance-equation" class="section level2">
<h2 class="hasAnchor">
<a href="#muskats-material-balance-equation" class="anchor"></a>Muskat’s Material Balance Equation</h2>
<p>For the Muskat’s Material Balance equation:</p>
<p><span class="math display">\[\newcommand{\numD}{{\dfrac {S_o}{B_o B_g} \dfrac {dR_s}{dP} +  
\dfrac {S_o}{B_o} \dfrac {k_g}{k_o} \dfrac {\mu_o}{\mu_g} \dfrac {dB_o}{dP} + 
(1 - S_o - S_w) \dfrac {1}{B_g} \dfrac {dB_g}{dP} }}\]</span></p>
<p><span class="math display">\[\dfrac {dS_o}{dP} = \dfrac {\numD} {1 + \dfrac {k_g}{k_o} \dfrac {\mu_o}{\mu_g} }\]</span></p>
<p>All the terms on the right side are function of pressure (<span class="math inline">\(P\)</span>) and saturation (<span class="math inline">\(S\)</span>), the equation could be reduced to:</p>
<p><span class="math display">\[ \dfrac{dS}{dP} = f(P, S)\]</span></p>
<p>A first-order ordinary diferential equation (<em>ODE</em>) with the general analytical solution:</p>
<p><span class="math display">\[y(x) = C_1e^x-2x-2\]</span></p>
</div>
<div id="solving-the-1st-order-differential-equation-ode" class="section level2">
<h2 class="hasAnchor">
<a href="#solving-the-1st-order-differential-equation-ode" class="anchor"></a>Solving the 1st Order Differential Equation (ODE)</h2>
<p>Given the following ODE that represents a particular reservoir: <span class="math display">\[ \dfrac{dS}{dP} = (2P +  S)\]</span></p>
<p>We wish to find the first saturation values if the initial conditions are:</p>
<p><span class="math inline">\(P_o\)</span> = 0, and <span class="math inline">\(S_o\)</span> = 1.</p>
<p>The analytical solution for the differential equation, given the initial conditions, is: <span class="math display">\[S(P) = 3e^P-2P-2\]</span> ## Building the ODE for Material Balance Since we know the analytical solution, we will add a method <code>getExactSolution</code> to return the exact values at any given P. Then we will compare the exact solution versus the numerical solutions from the available ODE solvers in <code>rODE</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># the ODE object</span>
<span class="kw">library</span>(rODE)
<span class="kw">library</span>(ggplot2)

<span class="co"># class declaration</span>
<span class="kw">setClass</span>(<span class="st">"MuskatODE"</span>, <span class="dt">slots =</span> <span class="kw">c</span>(
    <span class="dt">stack =</span> <span class="st">"environment"</span>                  <span class="co"># environment object inside the class</span>
    ),
    <span class="dt">contains =</span> <span class="kw">c</span>(<span class="st">"ODE"</span>)
    )
<span class="co"># Initialization method</span>
<span class="kw">setMethod</span>(<span class="st">"initialize"</span>, <span class="st">"MuskatODE"</span>, <span class="cf">function</span>(.Object, ...) {
    .Object<span class="op">@</span>stack<span class="op">$</span>n &lt;-<span class="st">  </span><span class="dv">0</span>               
    <span class="kw">return</span>(.Object)
})
<span class="co"># The exact solution method</span>
<span class="kw">setMethod</span>(<span class="st">"getExactSolution"</span>, <span class="st">"MuskatODE"</span>, <span class="cf">function</span>(object, t, ...) {
    <span class="co"># analytical solution</span>
    <span class="kw">return</span>(<span class="dv">3</span> <span class="op">*</span><span class="st"> </span><span class="kw">exp</span>(t) <span class="op">-</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span>t <span class="op">-</span><span class="st"> </span><span class="dv">2</span>)                             <span class="co"># constant C1 = 3 </span>
})
<span class="co"># obtain the state of the ODE</span>
<span class="kw">setMethod</span>(<span class="st">"getState"</span>, <span class="st">"MuskatODE"</span>, <span class="cf">function</span>(object, ...) {
    object<span class="op">@</span>state                                      <span class="co"># return the state</span>
})
<span class="co"># the differential equation is entered here. </span>
<span class="kw">setMethod</span>(<span class="st">"getRate"</span>, <span class="st">"MuskatODE"</span>, <span class="cf">function</span>(object, state, ...) {
    object<span class="op">@</span>rate[<span class="dv">1</span>] &lt;-<span class="st"> </span>state[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>state[<span class="dv">2</span>]         <span class="co"># 2P + S</span>
    object<span class="op">@</span>rate[<span class="dv">2</span>] &lt;-<span class="st"> </span><span class="dv">1</span>                               <span class="co"># dP/dP</span>
    object<span class="op">@</span>stack<span class="op">$</span>n &lt;-<span class="st"> </span>object<span class="op">@</span>stack<span class="op">$</span>n <span class="op">+</span><span class="st"> </span><span class="dv">1</span>              <span class="co"># add 1 to the rate count</span>
    object<span class="op">@</span>rate                                       <span class="co"># return the rate</span>
})
<span class="co"># constructor</span>
MuskatODE &lt;-<span class="st"> </span><span class="cf">function</span>(P, S) {
    .MuskatEuler &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">"MuskatODE"</span>)
    .MuskatEuler<span class="op">@</span>state[<span class="dv">1</span>] =<span class="st"> </span>S        <span class="co"># S         state[1] is saturation</span>
    .MuskatEuler<span class="op">@</span>state[<span class="dv">2</span>] =<span class="st"> </span>P        <span class="co"># P = t     state[2] is pressure</span>
    <span class="kw">return</span>(.MuskatEuler)
}</code></pre></div>
<pre><code>## [1] "initialize"
## [1] "getExactSolution"
## [1] "getState"
## [1] "getRate"</code></pre>
</div>
<div id="implementing-the-euler-solver" class="section level2">
<h2 class="hasAnchor">
<a href="#implementing-the-euler-solver" class="anchor"></a>Implementing the Euler solver</h2>
<p>After we define the differential equation in shape of code, or ODE object, we move to build the iterative routine for the differential equation. We start with the given initial conditions, <span class="math inline">\(P =0\)</span>, and <span class="math inline">\(S=1\)</span>, stopping the iterations at <span class="math inline">\(P = 0.5\)</span>.</p>
<p>Since we don’t know the size of the infinitesimal step <span class="math inline">\(\Delta P\)</span> to use in the solver, we are given three different step sizes <code>0.2, 0.1, 0.05</code>. Depending of the accuracy of the solution, at the end a satisfactory step size will be selected.</p>
<p>As we go calculating the numerical solution with the Euler method, we are also getting the exact result from the analytical solution <span class="math inline">\(S(P) = 3e^P-2P-2\)</span>, using both to find the error and the relative error. The number of steps that the ODE solver takes is also recorded.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># application that uses the Muskat ODE solver above</span>
MuskatEulerApp &lt;-<span class="st"> </span><span class="cf">function</span>(stepSize) {
    ode &lt;-<span class="st"> </span><span class="kw">MuskatODE</span>(<span class="dv">0</span>, <span class="dv">1</span>)                      <span class="co"># initial state  S(0) = 1; P = 0</span>
    ode_solver &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Euler-class.html">Euler</a></span>(ode)                    <span class="co"># use the Euler ODE solver</span>
    ode_solver &lt;-<span class="st"> </span><span class="kw"><a href="../reference/setStepSize-method.html">setStepSize</a></span>(ode_solver, stepSize)
    rowVector &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">"list"</span>)      <span class="co"># calculation will be added to rowVector</span>
    pres &lt;-<span class="st">  </span><span class="dv">0</span>                       <span class="co"># P = 0</span>
    i    &lt;-<span class="st">  </span><span class="dv">1</span>                       <span class="co"># index of the iterations</span>
    <span class="cf">while</span> (pres <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.5</span>) {
        state &lt;-<span class="st"> </span><span class="kw"><a href="../reference/getState-method.html">getState</a></span>(ode_solver<span class="op">@</span>ode)  
        pres  &lt;-<span class="st"> </span>state[<span class="dv">2</span>]
        error &lt;-<span class="st"> </span><span class="kw"><a href="../reference/getExactSolution-method.html">getExactSolution</a></span>(ode_solver<span class="op">@</span>ode, pres) <span class="op">-</span><span class="st"> </span>state[<span class="dv">1</span>]
        rowVector[[i]] &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">step_size =</span> stepSize,  <span class="co"># vector with calculations</span>
                               <span class="dt">P =</span> pres, 
                               <span class="dt">S =</span> state[<span class="dv">1</span>], 
                               <span class="dt">exact =</span> <span class="kw"><a href="../reference/getExactSolution-method.html">getExactSolution</a></span>(ode_solver<span class="op">@</span>ode, pres),
                               <span class="dt">error =</span> error, 
                               <span class="dt">rel_err =</span> error <span class="op">/</span><span class="st"> </span><span class="kw"><a href="../reference/getExactSolution-method.html">getExactSolution</a></span>(ode_solver<span class="op">@</span>ode, pres),
                               <span class="dt">steps =</span> ode_solver<span class="op">@</span>ode<span class="op">@</span>stack<span class="op">$</span>n
                               )
        ode_solver &lt;-<span class="st"> </span><span class="kw"><a href="../reference/step-method.html">step</a></span>(ode_solver)                 <span class="co"># advance solver one step</span>
        i &lt;-<span class="st"> </span>i <span class="op">+</span><span class="st"> </span><span class="dv">1</span>                                     <span class="co"># advance iteration</span>
    }
    data.table<span class="op">::</span><span class="kw">rbindlist</span>(rowVector)                   <span class="co"># results in data table</span>
}</code></pre></div>
<div id="summary-table" class="section level3">
<h3 class="hasAnchor">
<a href="#summary-table" class="anchor"></a>Summary table</h3>
<p>After the iteration model is completed, it is time to analyze the results stored in the table. We do this by sending the three step sizes for <span class="math inline">\(\Delta P\)</span> using the function <code>lapply</code>. Since we don’t want to see all the intermediate steps, we will limit the result table to display only the solutions at <span class="math inline">\(P\)</span> equal <code>0.10, 0.20, 0.30, 0.40, 0.5</code>.</p>
<p>The table has these columns or variables:</p>
<ul>
<li>
<code>step_size</code>: size of the step for the solver.</li>
<li>
<code>P</code>: pressure</li>
<li>
<code>S</code>: saturation</li>
<li>
<code>exact</code>: exact value from the analytical solution</li>
<li>
<code>error</code>: difference between the analytical solution and the numerical solution</li>
<li>
<code>rel_err</code>: relative error</li>
<li>
<code>steps</code>: number of steps taken by the solver</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># get a summary table for different step sizes</span>
get_table &lt;-<span class="st"> </span><span class="cf">function</span>(stepSize) {
    dt &lt;-<span class="st"> </span><span class="kw">MuskatEulerApp</span>(stepSize)
    dt[<span class="kw">round</span>(P, <span class="dv">2</span>) <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="fl">0.10</span>, <span class="fl">0.20</span>, <span class="fl">0.30</span>, <span class="fl">0.40</span>, <span class="fl">0.5</span>)]  
}
<span class="co"># vector with some step sizes</span>
step_sizes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.2</span>, <span class="fl">0.1</span>, <span class="fl">0.05</span>)
dt_li &lt;-<span class="st"> </span><span class="kw">lapply</span>(step_sizes, get_table)    <span class="co"># create a data table </span>
data.table<span class="op">::</span><span class="kw">rbindlist</span>(dt_li)              <span class="co"># bind the data tables</span></code></pre></div>
<pre><code>##     step_size   P        S    exact       error     rel_err steps
##  1:      0.20 0.2 1.200000 1.264208 0.064208274 0.050789317     1
##  2:      0.20 0.4 1.520000 1.675474 0.155474093 0.092794089     2
##  3:      0.10 0.1 1.100000 1.115513 0.015512754 0.013906389     1
##  4:      0.10 0.2 1.230000 1.264208 0.034208274 0.027059050     2
##  5:      0.10 0.3 1.393000 1.449576 0.056576423 0.039029624     3
##  6:      0.10 0.4 1.592300 1.675474 0.083174093 0.049642124     4
##  7:      0.10 0.5 1.831530 1.946164 0.114633812 0.058902448     5
##  8:      0.05 0.1 1.107500 1.115513 0.008012754 0.007183023     2
##  9:      0.05 0.2 1.246519 1.264208 0.017689524 0.013992571     4
## 10:      0.05 0.3 1.420287 1.449576 0.029289501 0.020205558     6
## 11:      0.05 0.4 1.632366 1.675474 0.043107762 0.025728695     8
## 12:      0.05 0.5 1.886684 1.946164 0.059479932 0.030562654    10</code></pre>
<p>We can see from the table that for the smaller step size of <code>0.05</code> at <span class="math inline">\(P = 0.5\)</span>, we get a relative error of approximately <code>0.0306</code>, or 3%. We willimprove this by using improved solvers.</p>
</div>
</div>
<div id="solve-muskats-equation-using-runge-kutta" class="section level2">
<h2 class="hasAnchor">
<a href="#solve-muskats-equation-using-runge-kutta" class="anchor"></a>Solve Muskat’s Equation using Runge-Kutta</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">MuskatRK4App &lt;-<span class="st"> </span><span class="cf">function</span>(stepSize) {
    ode &lt;-<span class="st"> </span><span class="kw">MuskatODE</span>(<span class="dv">0</span>, <span class="dv">1</span>)
    ode_solver &lt;-<span class="st"> </span><span class="kw"><a href="../reference/RK4-class.html">RK4</a></span>(ode)
    ode_solver &lt;-<span class="st"> </span><span class="kw"><a href="../reference/setStepSize-method.html">setStepSize</a></span>(ode_solver, stepSize)
    rowVector  &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">"list"</span>)
    pres &lt;-<span class="st">  </span><span class="dv">0</span>
    i    &lt;-<span class="st">  </span><span class="dv">1</span>
    <span class="cf">while</span> (pres <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.5</span>) {
        state &lt;-<span class="st"> </span><span class="kw"><a href="../reference/getState-method.html">getState</a></span>(ode_solver<span class="op">@</span>ode)
        pres &lt;-<span class="st"> </span>state[<span class="dv">2</span>]
        error &lt;-<span class="st"> </span><span class="kw"><a href="../reference/getExactSolution-method.html">getExactSolution</a></span>(ode_solver<span class="op">@</span>ode, pres) <span class="op">-</span><span class="st"> </span>state[<span class="dv">1</span>]
        rowVector[[i]] &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">step_size =</span> stepSize, 
                               <span class="dt">P =</span> pres, 
                               <span class="dt">S =</span> state[<span class="dv">1</span>], 
                               <span class="dt">exact =</span> <span class="kw"><a href="../reference/getExactSolution-method.html">getExactSolution</a></span>(ode_solver<span class="op">@</span>ode, pres),
                               <span class="dt">error =</span> error, 
                               <span class="dt">rel_err =</span> error <span class="op">/</span><span class="st"> </span><span class="kw"><a href="../reference/getExactSolution-method.html">getExactSolution</a></span>(ode_solver<span class="op">@</span>ode, pres),
                               <span class="dt">steps =</span> ode_solver<span class="op">@</span>ode<span class="op">@</span>stack<span class="op">$</span>n
                               )
        ode_solver &lt;-<span class="st"> </span><span class="kw"><a href="../reference/step-method.html">step</a></span>(ode_solver)
        i &lt;-<span class="st"> </span>i <span class="op">+</span><span class="st"> </span><span class="dv">1</span>
    }
    data.table<span class="op">::</span><span class="kw">rbindlist</span>(rowVector)
}
<span class="co"># get a summary table for different step sizes</span>
get_table &lt;-<span class="st"> </span><span class="cf">function</span>(stepSize) {
    dt &lt;-<span class="st"> </span><span class="kw">MuskatRK4App</span>(stepSize)
    dt[<span class="kw">round</span>(P, <span class="dv">2</span>) <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="fl">0.10</span>, <span class="fl">0.20</span>, <span class="fl">0.30</span>, <span class="fl">0.40</span>, <span class="fl">0.5</span>)]
}
step_sizes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.2</span>, <span class="fl">0.1</span>, <span class="fl">0.05</span>)
dt_li &lt;-<span class="st"> </span><span class="kw">lapply</span>(step_sizes, get_table)
data.table<span class="op">::</span><span class="kw">rbindlist</span>(dt_li)</code></pre></div>
<pre><code>##     step_size   P        S    exact        error      rel_err steps
##  1:      0.20 0.2 1.264200 1.264208 8.274481e-06 6.545188e-06     4
##  2:      0.20 0.4 1.675454 1.675474 2.021292e-05 1.206400e-05     8
##  3:      0.10 0.1 1.115512 1.115513 2.542269e-07 2.279014e-07     4
##  4:      0.10 0.2 1.264208 1.264208 5.619284e-07 4.444904e-07     8
##  5:      0.10 0.3 1.449575 1.449576 9.315404e-07 6.426294e-07    12
##  6:      0.10 0.4 1.675473 1.675474 1.372682e-06 8.192796e-07    16
##  7:      0.10 0.5 1.946162 1.946164 1.896310e-06 9.743835e-07    20
##  8:      0.05 0.1 1.115513 1.115513 1.656398e-08 1.484876e-08     8
##  9:      0.05 0.2 1.264208 1.264208 3.661206e-08 2.896046e-08    16
## 10:      0.05 0.3 1.449576 1.449576 6.069387e-08 4.187007e-08    24
## 11:      0.05 0.4 1.675474 1.675474 8.943613e-08 5.337960e-08    32
## 12:      0.05 0.5 1.946164 1.946164 1.235528e-07 6.348528e-08    40</code></pre>
<p>We see above that we are repeating code when the only parameter needed to be changed is the ODE solver. In cases where we want to test different ODE solvers it is more convenient to use the function <code>ODESolverFactory</code> and send the solver (Euler, RK4, Verlet, etc.), as a parameter.</p>
</div>
<div id="using-a-solver-factory" class="section level2">
<h2 class="hasAnchor">
<a href="#using-a-solver-factory" class="anchor"></a>Using a solver factory</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ComparisonMuskatODEApp &lt;-<span class="st"> </span><span class="cf">function</span>(solver, stepSize) {
    ode &lt;-<span class="st"> </span><span class="kw">MuskatODE</span>(<span class="dv">0</span>, <span class="dv">1</span>)
    solver_factory &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ODESolverFactory-class.html">ODESolverFactory</a></span>()
    ode_solver &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ODESolverFactory-class.html">createODESolver</a></span>(solver_factory, ode, solver)
    ode_solver &lt;-<span class="st"> </span><span class="kw"><a href="../reference/setStepSize-method.html">setStepSize</a></span>(ode_solver, stepSize)
    rowVector  &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">"list"</span>)
    pres &lt;-<span class="st">  </span><span class="dv">0</span>
    i    &lt;-<span class="st">  </span><span class="dv">1</span>
    <span class="cf">while</span> (pres <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.5001</span>) {
        state &lt;-<span class="st"> </span><span class="kw"><a href="../reference/getState-method.html">getState</a></span>(ode_solver<span class="op">@</span>ode)
        pres  &lt;-<span class="st"> </span>state[<span class="dv">2</span>]
        error &lt;-<span class="st"> </span><span class="kw"><a href="../reference/getExactSolution-method.html">getExactSolution</a></span>(ode_solver<span class="op">@</span>ode, pres) <span class="op">-</span><span class="st"> </span>state[<span class="dv">1</span>]
        rowVector[[i]] &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">solver =</span> solver,
                               <span class="dt">step_size =</span> stepSize, 
                               <span class="dt">P =</span> pres, 
                               <span class="dt">S =</span> state[<span class="dv">1</span>], 
                               <span class="dt">exact =</span> <span class="kw"><a href="../reference/getExactSolution-method.html">getExactSolution</a></span>(ode_solver<span class="op">@</span>ode, pres),
                               <span class="dt">error =</span> error, 
                               <span class="dt">rel_err =</span> error <span class="op">/</span><span class="st"> </span><span class="kw"><a href="../reference/getExactSolution-method.html">getExactSolution</a></span>(ode_solver<span class="op">@</span>ode, pres),
                               <span class="dt">steps =</span> ode_solver<span class="op">@</span>ode<span class="op">@</span>stack<span class="op">$</span>n
                               )
        ode_solver &lt;-<span class="st"> </span><span class="kw"><a href="../reference/step-method.html">step</a></span>(ode_solver)
        pres &lt;-<span class="st"> </span>pres <span class="op">+</span><span class="st"> </span><span class="kw"><a href="../reference/getStepSize-method.html">getStepSize</a></span>(ode_solver)    <span class="co"># step size retrievd from ODE solver</span>
        i &lt;-<span class="st"> </span>i <span class="op">+</span><span class="st"> </span><span class="dv">1</span>
    }
    data.table<span class="op">::</span><span class="kw">rbindlist</span>(rowVector)
}
<span class="co"># get a summary table for different step sizes</span>
create_table &lt;-<span class="st"> </span><span class="cf">function</span>(stepSize, solver) {
    dt &lt;-<span class="st"> </span><span class="kw">ComparisonMuskatODEApp</span>(solver, stepSize)
    <span class="cf">if</span> (<span class="op">!</span>solver <span class="op">==</span><span class="st"> "RK45"</span>) dt[<span class="kw">round</span>(P, <span class="dv">2</span>) <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="fl">0.10</span>, <span class="fl">0.20</span>, <span class="fl">0.30</span>, <span class="fl">0.40</span>, <span class="fl">0.5</span>)]
    <span class="cf">else</span> dt
}</code></pre></div>
<div id="euler" class="section level3">
<h3 class="hasAnchor">
<a href="#euler" class="anchor"></a>Euler</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create summary table for ODE solver Euler</span>
step_sizes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.2</span>, <span class="fl">0.1</span>, <span class="fl">0.05</span>)
dt_li &lt;-<span class="st"> </span><span class="kw">lapply</span>(step_sizes, create_table, <span class="dt">solver =</span> <span class="st">"Euler"</span>)
data.table<span class="op">::</span><span class="kw">rbindlist</span>(dt_li)</code></pre></div>
<pre><code>##     solver step_size   P        S    exact       error     rel_err steps
##  1:  Euler      0.20 0.2 1.200000 1.264208 0.064208274 0.050789317     1
##  2:  Euler      0.20 0.4 1.520000 1.675474 0.155474093 0.092794089     2
##  3:  Euler      0.10 0.1 1.100000 1.115513 0.015512754 0.013906389     1
##  4:  Euler      0.10 0.2 1.230000 1.264208 0.034208274 0.027059050     2
##  5:  Euler      0.10 0.3 1.393000 1.449576 0.056576423 0.039029624     3
##  6:  Euler      0.10 0.4 1.592300 1.675474 0.083174093 0.049642124     4
##  7:  Euler      0.10 0.5 1.831530 1.946164 0.114633812 0.058902448     5
##  8:  Euler      0.05 0.1 1.107500 1.115513 0.008012754 0.007183023     2
##  9:  Euler      0.05 0.2 1.246519 1.264208 0.017689524 0.013992571     4
## 10:  Euler      0.05 0.3 1.420287 1.449576 0.029289501 0.020205558     6
## 11:  Euler      0.05 0.4 1.632366 1.675474 0.043107762 0.025728695     8
## 12:  Euler      0.05 0.5 1.886684 1.946164 0.059479932 0.030562654    10</code></pre>
</div>
<div id="euler-richardson" class="section level3">
<h3 class="hasAnchor">
<a href="#euler-richardson" class="anchor"></a>Euler-Richardson</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create summary table for ODE solver EulerRichardson</span>
step_sizes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.2</span>, <span class="fl">0.1</span>, <span class="fl">0.05</span>)
dt_li &lt;-<span class="st"> </span><span class="kw">lapply</span>(step_sizes, create_table, <span class="dt">solver =</span> <span class="st">"EulerRichardson"</span>)
data.table<span class="op">::</span><span class="kw">rbindlist</span>(dt_li)</code></pre></div>
<pre><code>##              solver step_size   P        S    exact        error
##  1: EulerRichardson      0.20 0.2 1.260000 1.264208 0.0042082745
##  2: EulerRichardson      0.20 0.4 1.665200 1.675474 0.0102740929
##  3: EulerRichardson      0.10 0.1 1.115000 1.115513 0.0005127542
##  4: EulerRichardson      0.10 0.2 1.263075 1.264208 0.0011332745
##  5: EulerRichardson      0.10 0.3 1.447698 1.449576 0.0018785477
##  6: EulerRichardson      0.10 0.4 1.672706 1.675474 0.0027679410
##  7: EulerRichardson      0.10 0.5 1.942340 1.946164 0.0038235143
##  8: EulerRichardson      0.05 0.1 1.115380 1.115513 0.0001330667
##  9: EulerRichardson      0.05 0.2 1.263914 1.264208 0.0002941171
## 10: EulerRichardson      0.05 0.3 1.449089 1.449576 0.0004875646
## 11: EulerRichardson      0.05 0.4 1.674756 1.675474 0.0007184419
## 12: EulerRichardson      0.05 0.5 1.945171 1.946164 0.0009924815
##          rel_err steps
##  1: 0.0033287826     2
##  2: 0.0061320512     4
##  3: 0.0004596579     2
##  4: 0.0008964302     4
##  5: 0.0012959287     6
##  6: 0.0016520345     8
##  7: 0.0019646415    10
##  8: 0.0001192875     4
##  9: 0.0002326492     8
## 10: 0.0003363497    12
## 11: 0.0004287992    16
## 12: 0.0005099681    20</code></pre>
</div>
<div id="runge-kutta" class="section level3">
<h3 class="hasAnchor">
<a href="#runge-kutta" class="anchor"></a>Runge-Kutta</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create summary table for ODE solver RK4</span>
step_sizes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.2</span>, <span class="fl">0.1</span>, <span class="fl">0.05</span>)
dt_li &lt;-<span class="st"> </span><span class="kw">lapply</span>(step_sizes, create_table, <span class="dt">solver =</span> <span class="st">"RK4"</span>)
data.table<span class="op">::</span><span class="kw">rbindlist</span>(dt_li)</code></pre></div>
<pre><code>##     solver step_size   P        S    exact        error      rel_err steps
##  1:    RK4      0.20 0.2 1.264200 1.264208 8.274481e-06 6.545188e-06     4
##  2:    RK4      0.20 0.4 1.675454 1.675474 2.021292e-05 1.206400e-05     8
##  3:    RK4      0.10 0.1 1.115512 1.115513 2.542269e-07 2.279014e-07     4
##  4:    RK4      0.10 0.2 1.264208 1.264208 5.619284e-07 4.444904e-07     8
##  5:    RK4      0.10 0.3 1.449575 1.449576 9.315404e-07 6.426294e-07    12
##  6:    RK4      0.10 0.4 1.675473 1.675474 1.372682e-06 8.192796e-07    16
##  7:    RK4      0.10 0.5 1.946162 1.946164 1.896310e-06 9.743835e-07    20
##  8:    RK4      0.05 0.1 1.115513 1.115513 1.656398e-08 1.484876e-08     8
##  9:    RK4      0.05 0.2 1.264208 1.264208 3.661206e-08 2.896046e-08    16
## 10:    RK4      0.05 0.3 1.449576 1.449576 6.069387e-08 4.187007e-08    24
## 11:    RK4      0.05 0.4 1.675474 1.675474 8.943613e-08 5.337960e-08    32
## 12:    RK4      0.05 0.5 1.946164 1.946164 1.235528e-07 6.348528e-08    40</code></pre>
</div>
<div id="runge-kutta-45" class="section level3">
<h3 class="hasAnchor">
<a href="#runge-kutta-45" class="anchor"></a>Runge-Kutta 45</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create summary table for ODE solver RK45</span>
step_sizes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.2</span>, <span class="fl">0.1</span>, <span class="fl">0.05</span>)

<span class="co"># do not round because RK45 makes variable step sizes</span>
dt_li &lt;-<span class="st"> </span><span class="kw">lapply</span>(step_sizes, create_table, <span class="dt">solver =</span> <span class="st">"RK45"</span>)
data.table<span class="op">::</span><span class="kw">rbindlist</span>(dt_li)</code></pre></div>
<pre><code>##     solver step_size         P        S    exact        error      rel_err
##  1:   RK45      0.20 0.0000000 1.000000 1.000000 0.000000e+00 0.000000e+00
##  2:   RK45      0.20 0.2000000 1.264208 1.264208 3.448051e-08 2.727439e-08
##  3:   RK45      0.20 0.4000000 1.675474 1.675474 8.422918e-08 5.027185e-08
##  4:   RK45      0.10 0.0000000 1.000000 1.000000 0.000000e+00 0.000000e+00
##  5:   RK45      0.10 0.1000000 1.115513 1.115513 4.769420e-10 4.275541e-10
##  6:   RK45      0.10 0.2961235 1.441662 1.441662 3.431222e-08 2.380047e-08
##  7:   RK45      0.10 0.4922470 1.923470 1.923470 8.278777e-08 4.304083e-08
##  8:   RK45      0.05 0.0000000 1.000000 1.000000 0.000000e+00 0.000000e+00
##  9:   RK45      0.05 0.0500000 1.053813 1.053813 6.978196e-12 6.621852e-12
## 10:   RK45      0.05 0.2445709 1.342078 1.342078 3.054565e-08 2.275997e-08
## 11:   RK45      0.05 0.4391417 1.775842 1.775842 7.420278e-08 4.178456e-08
##     steps
##  1:     0
##  2:     6
##  3:    12
##  4:     0
##  5:     6
##  6:    12
##  7:    18
##  8:     0
##  9:     6
## 10:    12
## 11:    18</code></pre>
<p>And so on. We could this better. We will show how to do this using nested <code>lapply</code> functions.</p>
</div>
</div>
<div id="what-about-doing-all-in-one-step" class="section level2">
<h2 class="hasAnchor">
<a href="#what-about-doing-all-in-one-step" class="anchor"></a>What about doing all in one step</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># vectors for the solvers and step sizes</span>
step_sizes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.2</span>, <span class="fl">0.1</span>, <span class="fl">0.05</span>)
solvers &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"Euler"</span>, <span class="st">"EulerRichardson"</span>, <span class="st">"Verlet"</span>, <span class="st">"RK4"</span>, <span class="st">"RK45"</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># nested lapply to iterate through solvers and step sizes</span>
df_li &lt;-<span class="st"> </span><span class="kw">lapply</span>(solvers, <span class="cf">function</span>(svr)
            <span class="kw">lapply</span>(step_sizes, <span class="cf">function</span>(stepsz) <span class="kw">create_table</span>(stepsz, svr)))

<span class="co"># join the resulting dataframes</span>
df_all &lt;-<span class="st"> </span>data.table<span class="op">::</span><span class="kw">rbindlist</span>(<span class="kw">unlist</span>(df_li, <span class="dt">recursive =</span> <span class="ot">FALSE</span>))
df_all</code></pre></div>
<pre><code>##              solver step_size         P        S    exact        error
##  1:           Euler      0.20 0.2000000 1.200000 1.264208 6.420827e-02
##  2:           Euler      0.20 0.4000000 1.520000 1.675474 1.554741e-01
##  3:           Euler      0.10 0.1000000 1.100000 1.115513 1.551275e-02
##  4:           Euler      0.10 0.2000000 1.230000 1.264208 3.420827e-02
##  5:           Euler      0.10 0.3000000 1.393000 1.449576 5.657642e-02
##  6:           Euler      0.10 0.4000000 1.592300 1.675474 8.317409e-02
##  7:           Euler      0.10 0.5000000 1.831530 1.946164 1.146338e-01
##  8:           Euler      0.05 0.1000000 1.107500 1.115513 8.012754e-03
##  9:           Euler      0.05 0.2000000 1.246519 1.264208 1.768952e-02
## 10:           Euler      0.05 0.3000000 1.420287 1.449576 2.928950e-02
## 11:           Euler      0.05 0.4000000 1.632366 1.675474 4.310776e-02
## 12:           Euler      0.05 0.5000000 1.886684 1.946164 5.947993e-02
## 13: EulerRichardson      0.20 0.2000000 1.260000 1.264208 4.208274e-03
## 14: EulerRichardson      0.20 0.4000000 1.665200 1.675474 1.027409e-02
## 15: EulerRichardson      0.10 0.1000000 1.115000 1.115513 5.127542e-04
## 16: EulerRichardson      0.10 0.2000000 1.263075 1.264208 1.133274e-03
## 17: EulerRichardson      0.10 0.3000000 1.447698 1.449576 1.878548e-03
## 18: EulerRichardson      0.10 0.4000000 1.672706 1.675474 2.767941e-03
## 19: EulerRichardson      0.10 0.5000000 1.942340 1.946164 3.823514e-03
## 20: EulerRichardson      0.05 0.1000000 1.115380 1.115513 1.330667e-04
## 21: EulerRichardson      0.05 0.2000000 1.263914 1.264208 2.941171e-04
## 22: EulerRichardson      0.05 0.3000000 1.449089 1.449576 4.875646e-04
## 23: EulerRichardson      0.05 0.4000000 1.674756 1.675474 7.184419e-04
## 24: EulerRichardson      0.05 0.5000000 1.945171 1.946164 9.924815e-04
## 25:          Verlet      0.20 0.2000000 1.220000 1.264208 4.420827e-02
## 26:          Verlet      0.20 0.4000000 1.564000 1.675474 1.114741e-01
## 27:          Verlet      0.10 0.1000000 1.105000 1.115513 1.051275e-02
## 28:          Verlet      0.10 0.2000000 1.240500 1.264208 2.370827e-02
## 29:          Verlet      0.10 0.3000000 1.409550 1.449576 4.002642e-02
## 30:          Verlet      0.10 0.4000000 1.615505 1.675474 5.996909e-02
## 31:          Verlet      0.10 0.5000000 1.862055 1.946164 8.410831e-02
## 32:          Verlet      0.05 0.1000000 1.110062 1.115513 5.450254e-03
## 33:          Verlet      0.05 0.2000000 1.251906 1.264208 1.230187e-02
## 34:          Verlet      0.05 0.3000000 1.428789 1.449576 2.078711e-02
## 35:          Verlet      0.05 0.4000000 1.644303 1.675474 3.117138e-02
## 36:          Verlet      0.05 0.5000000 1.902406 1.946164 4.375757e-02
## 37:             RK4      0.20 0.2000000 1.264200 1.264208 8.274481e-06
## 38:             RK4      0.20 0.4000000 1.675454 1.675474 2.021292e-05
## 39:             RK4      0.10 0.1000000 1.115512 1.115513 2.542269e-07
## 40:             RK4      0.10 0.2000000 1.264208 1.264208 5.619284e-07
## 41:             RK4      0.10 0.3000000 1.449575 1.449576 9.315404e-07
## 42:             RK4      0.10 0.4000000 1.675473 1.675474 1.372682e-06
## 43:             RK4      0.10 0.5000000 1.946162 1.946164 1.896310e-06
## 44:             RK4      0.05 0.1000000 1.115513 1.115513 1.656398e-08
## 45:             RK4      0.05 0.2000000 1.264208 1.264208 3.661206e-08
## 46:             RK4      0.05 0.3000000 1.449576 1.449576 6.069387e-08
## 47:             RK4      0.05 0.4000000 1.675474 1.675474 8.943613e-08
## 48:             RK4      0.05 0.5000000 1.946164 1.946164 1.235528e-07
## 49:            RK45      0.20 0.0000000 1.000000 1.000000 0.000000e+00
## 50:            RK45      0.20 0.2000000 1.264208 1.264208 3.448051e-08
## 51:            RK45      0.20 0.4000000 1.675474 1.675474 8.422918e-08
## 52:            RK45      0.10 0.0000000 1.000000 1.000000 0.000000e+00
## 53:            RK45      0.10 0.1000000 1.115513 1.115513 4.769420e-10
## 54:            RK45      0.10 0.2961235 1.441662 1.441662 3.431222e-08
## 55:            RK45      0.10 0.4922470 1.923470 1.923470 8.278777e-08
## 56:            RK45      0.05 0.0000000 1.000000 1.000000 0.000000e+00
## 57:            RK45      0.05 0.0500000 1.053813 1.053813 6.978196e-12
## 58:            RK45      0.05 0.2445709 1.342078 1.342078 3.054565e-08
## 59:            RK45      0.05 0.4391417 1.775842 1.775842 7.420278e-08
##              solver step_size         P        S    exact        error
##          rel_err steps
##  1: 5.078932e-02     1
##  2: 9.279409e-02     2
##  3: 1.390639e-02     1
##  4: 2.705905e-02     2
##  5: 3.902962e-02     3
##  6: 4.964212e-02     4
##  7: 5.890245e-02     5
##  8: 7.183023e-03     2
##  9: 1.399257e-02     4
## 10: 2.020556e-02     6
## 11: 2.572869e-02     8
## 12: 3.056265e-02    10
## 13: 3.328783e-03     2
## 14: 6.132051e-03     4
## 15: 4.596579e-04     2
## 16: 8.964302e-04     4
## 17: 1.295929e-03     6
## 18: 1.652035e-03     8
## 19: 1.964642e-03    10
## 20: 1.192875e-04     4
## 21: 2.326492e-04     8
## 22: 3.363497e-04    12
## 23: 4.287992e-04    16
## 24: 5.099681e-04    20
## 25: 3.496914e-02     2
## 26: 6.653287e-02     4
## 27: 9.424145e-03     2
## 28: 1.875346e-02     4
## 29: 2.761250e-02     6
## 30: 3.579231e-02     8
## 31: 4.321749e-02    10
## 32: 4.885874e-03     4
## 33: 9.730887e-03     8
## 34: 1.434013e-02    12
## 35: 1.860451e-02    16
## 36: 2.248401e-02    20
## 37: 6.545188e-06     4
## 38: 1.206400e-05     8
## 39: 2.279014e-07     4
## 40: 4.444904e-07     8
## 41: 6.426294e-07    12
## 42: 8.192796e-07    16
## 43: 9.743835e-07    20
## 44: 1.484876e-08     8
## 45: 2.896046e-08    16
## 46: 4.187007e-08    24
## 47: 5.337960e-08    32
## 48: 6.348528e-08    40
## 49: 0.000000e+00     0
## 50: 2.727439e-08     6
## 51: 5.027185e-08    12
## 52: 0.000000e+00     0
## 53: 4.275541e-10     6
## 54: 2.380047e-08    12
## 55: 4.304083e-08    18
## 56: 0.000000e+00     0
## 57: 6.621852e-12     6
## 58: 2.275997e-08    12
## 59: 4.178456e-08    18
##          rel_err steps</code></pre>
<div id="plot-the-error-of-the-solvers" class="section level3">
<h3 class="hasAnchor">
<a href="#plot-the-error-of-the-solvers" class="anchor"></a>Plot the error of the solvers</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(df_all, <span class="kw">aes</span>(<span class="dt">x =</span> P, <span class="dt">y =</span> rel_err, <span class="dt">group =</span> step_size, <span class="dt">fill =</span> solver )) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_area</span>(<span class="dt">stat =</span> <span class="st">"identity"</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">facet_grid</span>(step_size <span class="op">~</span><span class="st"> </span>solver)</code></pre></div>
<p><img src="Muskat-MBal_files/figure-html/unnamed-chunk-12-1.png" width="672"></p>
<p>In this last plot we want to compare the relative error of the ODE solvers that show the least error: RK4 and RK45. At the same time, we will exclude the step size of 0.2 since its error magnitude would hide those of the smaller steps.</p>
</div>
<div id="plot-rk4-vs-rk45" class="section level3">
<h3 class="hasAnchor">
<a href="#plot-rk4-vs-rk45" class="anchor"></a>Plot RK4 vs RK45</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="kw">subset</span>(df_all, solver <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"RK4"</span>, <span class="st">"RK45"</span>) <span class="op">&amp;</span><span class="st"> </span>step_size <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.05</span>)), <span class="kw">aes</span>(<span class="dt">x =</span> P, <span class="dt">y =</span> rel_err, <span class="dt">group =</span> step_size, <span class="dt">fill =</span> solver )) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_area</span>(<span class="dt">stat =</span> <span class="st">"identity"</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">facet_grid</span>(step_size <span class="op">~</span><span class="st"> </span>solver) </code></pre></div>
<p><img src="Muskat-MBal_files/figure-html/unnamed-chunk-13-1.png" width="672"></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#muskats-material-balance-equation">Muskat’s Material Balance Equation</a></li>
      <li><a href="#solving-the-1st-order-differential-equation-ode">Solving the 1st Order Differential Equation (ODE)</a></li>
      <li><a href="#implementing-the-euler-solver">Implementing the Euler solver</a></li>
      <li><a href="#solve-muskats-equation-using-runge-kutta">Solve Muskat’s Equation using Runge-Kutta</a></li>
      <li><a href="#using-a-solver-factory">Using a solver factory</a></li>
      <li><a href="#what-about-doing-all-in-one-step">What about doing all in one step</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Alfonso R. Reyes.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>

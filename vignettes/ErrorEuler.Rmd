---
title: "Error with Euler method"
author: "Alfonso R. Reyes"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Error with Euler method}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

Given the differential equation:

$$ \frac {dy} {dx} = x + y $$

Use the Euler ODE solver to find the error between the exact solution given by:

$$ y(x) = e^e - x - 1$$

at these step sizes: 1, 0.5, 0.25, 0.1, 0.01, 0.001, 0.0001; and plot the the step size versus the error when the $x = 1$.

## Build the ODE solver

```{r message=FALSE, results="hold"}
library(rODE)

setClass("EulerError", slots = c(
    stack = "environment"           # environment object inside the class
    ),
    contains = c("ODE")
    )

setMethod("initialize", "EulerError", function(.Object, ...) {
    .Object@stack$n <-  0               # "n" belongs to the class environment
    .Object@state   <- c(0.0, 1.0)
    return(.Object)
})

setMethod("getExactSolution", "EulerError", function(object, t, ...) {
    # analytical solution
    return(exp(t) - t - 1)
})

setMethod("getState", "EulerError", function(object, ...) {
    object@state
})

setMethod("getRate", "EulerError", function(object, state, ...) {
    object@rate[1] <- 1
    object@rate[2] <- state[1] + state[2]
    object@stack$n <-  object@stack$n + 1       # add 1 to the rate count
    object@rate
})

# constructor
EulerError <- function() {
    odetest <- new("EulerError")
    return(odetest)
}
```

```{r}
# class implementation
EulerErrorApp <- function(verbose = FALSE) {
    ode        <- new("EulerError")
    ode_solver <- Euler(ode)
    ode_solver <- setStepSize(ode_solver, 0.1)
    
    cat(sprintf("%10s %14s %14s %5s \n", "time", "xl", "error", "n"))   # header
    time <-  0
    while (time < 50) {
        ode_solver <- step(ode_solver)
        stepSize   <- ode_solver@stepSize     # update the step size
        time       <- time + stepSize
        state      <- getState(ode_solver@ode)
        if (verbose)
            cat(sprintf("%10f %14e %14e %5d \n", 
                        time, 
                        state[1], 
                        state[1] - getExactSolution(ode_solver@ode, time),
                        ode_solver@ode@stack$n))
    }
    cat("rate steps evaluated #", ode_solver@ode@stack$n)
}

EulerErrorApp(verbose = TRUE)
```

